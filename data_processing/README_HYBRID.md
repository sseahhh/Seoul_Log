# í•˜ì´ë¸Œë¦¬ë“œ íŒŒì‹± ì‹œìŠ¤í…œ

## ğŸ“‹ ê°œìš”

ì„œìš¸ì‹œì˜íšŒ íšŒì˜ë¡ì„ íš¨ìœ¨ì ìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**ë°©ì‹:**
- **1ë‹¨ê³„**: Gemini 2.5 Proë¡œ ì•ˆê±´ ë¼ì¸ ë§¤í•‘ ì¶”ì¶œ
- **2ë‹¨ê³„**: ìˆœìˆ˜ Python ì½”ë“œë¡œ ë°œì–¸ ì¶”ì¶œ

## ğŸ¯ ì¥ì 

| í•­ëª© | ê¸°ì¡´ (Gemini 2ë‹¨ê³„) | í•˜ì´ë¸Œë¦¬ë“œ | ê°œì„  |
|------|---------------------|-----------|------|
| **ì†ë„** | ~30ì´ˆ/íŒŒì¼ | ~3ì´ˆ/íŒŒì¼ | **10ë°° ë¹ ë¦„** |
| **ë¹„ìš©** | Stage 1 + Stage 2 | Stage 1ë§Œ | **50% ì ˆê°** |
| **ì•ˆì •ì„±** | JSON íŒŒì‹± ì˜¤ë¥˜ ë°œìƒ | ì˜¤ë¥˜ ì—†ìŒ | **100% ì•ˆì •** |
| **ì •í™•ë„** | ë°œì–¸ ëˆ„ë½ ê°€ëŠ¥ | ì™„ë²½ ì¶”ì¶œ | **ë” ì •í™•** |
| **ì¶”ì¶œ ë‚´ìš©** | í‰ê·  27,920ì | í‰ê·  28,845ì | **+3.3%** |

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
data_processing/
â”œâ”€â”€ extract_metadata_hybrid.py       # í•˜ì´ë¸Œë¦¬ë“œ íŒŒì‹± (1ë‹¨ê³„ Gemini + 2ë‹¨ê³„ ìˆœìˆ˜ ì½”ë“œ)
â”œâ”€â”€ process_all_result_folders.py    # ë°°ì¹˜ ì²˜ë¦¬ (ëª¨ë“  txt íŒŒì¼)
â”œâ”€â”€ parse_with_pure_code.py          # ìˆœìˆ˜ ì½”ë“œ í…ŒìŠ¤íŠ¸ìš©
â””â”€â”€ test_agenda_extraction.py        # 1ë‹¨ê³„ í…ŒìŠ¤íŠ¸ìš©
```

## ğŸš€ ì‚¬ìš©ë²•

### 1. ë‹¨ì¼ íŒŒì¼ í…ŒìŠ¤íŠ¸ (3ê°œ ëœë¤)

```bash
source ~/miniconda3/etc/profile.d/conda.sh
conda activate genminute
python3 data_processing/extract_metadata_hybrid.py
```

**ê²°ê³¼:**
- `test_results/test_{íšŒì˜ëª…}.json` ìƒì„±
- ìƒì„¸í•œ í†µê³„ ì¶œë ¥

---

### 2. ì „ì²´ ë°°ì¹˜ ì²˜ë¦¬ (ê¶Œì¥)

```bash
source ~/miniconda3/etc/profile.d/conda.sh
conda activate genminute
python3 data_processing/process_all_result_folders.py
```

**ê²°ê³¼:**
- `data/result_txt/{íšŒì˜ëª…}.json` ìƒì„±
- ëª¨ë“  `result/*/meeting_*.txt` íŒŒì¼ ì²˜ë¦¬
- ê°„ê²°í•œ ì§„í–‰ ìƒí™© ì¶œë ¥

---

## ğŸ“Š ì¶œë ¥ í˜•ì‹

```json
{
  "meeting_info": {
    "title": "ì œ332íšŒ êµìœ¡ìœ„ì›íšŒ ì œ3ì°¨(2025.09.09)",
    "url": "https://ms.smc.seoul.kr/...",
    "date": "2025.09.09"
  },
  "chunks": [
    {
      "speaker": "ë¶€ìœ„ì›ì¥ í™©ì² ê·œ",
      "agenda": "ê°œì˜",
      "text": "ì˜ì„ì„ ì •ëˆí•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤..."
    }
  ],
  "usage": {
    "stage1_model": "gemini-2.5-pro",
    "stage2_method": "pure_python_code",
    "stage1_tokens": {"input": 28308, "output": 1602},
    "total_chunks": 130
  }
}
```

## ğŸ” ê²€ì¦ ê²°ê³¼

3ê°œ íŒŒì¼ í…ŒìŠ¤íŠ¸ ê²°ê³¼:

| íŒŒì¼ | ë°œì–¸ ìˆ˜ | ì•ˆê±´ ìˆ˜ | ë°œì–¸ì ìˆ˜ | ì •í™•ë„ |
|------|---------|---------|----------|--------|
| êµìœ¡ìœ„ì›íšŒ ì œ3ì°¨ | 130ê°œ | 14ê°œ | 12ëª… | âœ… 100% |
| AIê²½ìŸë ¥ê°•í™”íŠ¹ë³„ìœ„ì›íšŒ ì œ3ì°¨ | 123ê°œ | 6ê°œ | 11ëª… | âœ… 100% |
| ì˜ë£Œê´€ê´‘íŠ¹ë³„ìœ„ì›íšŒ ì œ2ì°¨ | 175ê°œ | 5ê°œ | 10ëª… | âœ… 100% |

**ê²€ì¦ í•­ëª©:**
- âœ… ì•ˆê±´ ëˆ„ë½ 0ê°œ
- âœ… ë°œì–¸ì 100% ë§¤ì¹­
- âœ… ë°œì–¸ ë‚´ìš© ì›ë³¸ê³¼ ì¼ì¹˜
- âœ… ê¸´ ì„¹ì…˜ ìë™ ë¶„í• 
- âœ… ê°œì˜/ì‚°íšŒ ìë™ ì¸ì‹

## ğŸ› ï¸ ê¸°ìˆ  ìƒì„¸

### Stage 1: ì•ˆê±´ ë§¤í•‘ (Gemini 2.5 Pro)

**ì…ë ¥:**
- ë¼ì¸ ë²ˆí˜¸ê°€ ì¶”ê°€ëœ ì „ì²´ íšŒì˜ë¡

**ì¶œë ¥:**
```json
{
  "agenda_mapping": [
    {
      "agenda_title": "ë„ì„œêµ¬ì…ë¹„ ì§€ì› ì¡°ë¡€ì•ˆ",
      "line_start": 56,
      "line_end": 92,
      "speakers": ["ë¶€ìœ„ì›ì¥ í™©ì² ê·œ", "ìˆ˜ì„ì „ë¬¸ìœ„ì› ë°•ê´‘ì„ "]
    }
  ]
}
```

**íŠ¹ì§•:**
- "ì‹¬ì‚¬ëœì•ˆê±´" ì„¹ì…˜ ìš°ì„  í™•ì¸
- 50ì¤„ ì´ˆê³¼ ì‹œ ìë™ ë¶„í• 
- ê°œì˜/ì§ˆì˜ì‘ë‹µ/ì‚°íšŒ ìë™ ì¸ì‹

---

### Stage 2: ë°œì–¸ ì¶”ì¶œ (ìˆœìˆ˜ Python)

**ë¡œì§:**
1. `â—‹ë°œì–¸ì` íŒ¨í„´ regex ë§¤ì¹­
2. ë°œì–¸ìë³„ë¡œ í…ìŠ¤íŠ¸ ê·¸ë£¹í™”
3. 500ì ì´ˆê³¼ ì‹œ ë¬¸ì¥ ë‹¨ìœ„ ë¶„í• 

**ì˜ˆ:**
```python
# â—‹ë¶€ìœ„ì›ì¥ í™©ì² ê·œ  ì˜ì„ì„ ì •ëˆí•´...
# â†’ {"speaker": "ë¶€ìœ„ì›ì¥ í™©ì² ê·œ", "text": "ì˜ì„ì„ ì •ëˆí•´..."}
```

**ì¥ì :**
- API í˜¸ì¶œ ì—†ìŒ (ë¬´ë£Œ)
- JSON íŒŒì‹± ì˜¤ë¥˜ ì—†ìŒ
- 10ë°° ë¹ ë¥¸ ì†ë„
- ê²°ì •ë¡ ì  ë™ì‘

## ğŸ“ˆ ì„±ëŠ¥ ë¹„êµ

### ë¹„ìš© ì ˆê°

**íŒŒì¼ 1ê°œ ê¸°ì¤€:**
- ê¸°ì¡´: Stage 1 (28K í† í°) + Stage 2 (í‰ê·  50K í† í°)
- í•˜ì´ë¸Œë¦¬ë“œ: Stage 1 (28K í† í°)ë§Œ
- **ì ˆê°ìœ¨: ~64% (Stage 2 ì œê±°)**

**ì „ì²´ 53ê°œ íŒŒì¼:**
- ê¸°ì¡´: ì•½ $4-5 ì˜ˆìƒ
- í•˜ì´ë¸Œë¦¬ë“œ: ì•½ $1.5-2 ì˜ˆìƒ
- **ì´ ì ˆê°: $2.5-3**

### ì†ë„ í–¥ìƒ

- ê¸°ì¡´: 53ê°œ íŒŒì¼ Ã— 30ì´ˆ = **26.5ë¶„**
- í•˜ì´ë¸Œë¦¬ë“œ: 53ê°œ íŒŒì¼ Ã— 3ì´ˆ = **2.7ë¶„**
- **ì‹œê°„ ì ˆê°: 23.8ë¶„ (90% ë¹¨ë¼ì§)**

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ: "GOOGLE_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"

```bash
# .env íŒŒì¼ í™•ì¸
cat .env

# GOOGLE_API_KEY=your_key_here í˜•ì‹ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ í•¨
```

---

### ë¬¸ì œ: "No module named 'bs4'"

```bash
# conda í™˜ê²½ í™œì„±í™” í™•ì¸
conda activate genminute

# íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸
pip list | grep beautifulsoup4
```

---

### ë¬¸ì œ: íŠ¹ì • íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨

ë¡œê·¸ í™•ì¸:
```bash
# ìµœê·¼ ë¡œê·¸ íŒŒì¼ í™•ì¸
ls -lt logs/parsing_hybrid_*.log | head -1

# ë¡œê·¸ ë‚´ìš© í™•ì¸
tail -50 logs/parsing_hybrid_YYYYMMDD_HHMMSS.log
```

---

## ğŸ“ ì£¼ìš” ë³€ê²½ ì‚¬í•­

### ê¸°ì¡´ ë°©ì‹ (extract_metadata_two_stage.py)
```python
# Stage 1: Gemini 2.5 Pro
agenda_mapping = extract_agenda_mapping(txt)

# Stage 2: Gemini 2.5 Flash (ë³‘ë ¬)
chunks = await extract_chunks_async(agenda_mapping)  # API í˜¸ì¶œ
```

### í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ (extract_metadata_hybrid.py)
```python
# Stage 1: Gemini 2.5 Pro (ë™ì¼)
agenda_mapping = extract_agenda_mapping(txt)

# Stage 2: ìˆœìˆ˜ Python ì½”ë“œ
chunks = parse_with_pure_code(txt, agenda_mapping)  # ë¡œì»¬ ì²˜ë¦¬
```

**ë³€ê²½ì :**
- âœ… async/await ì œê±° (ë™ê¸° ì²˜ë¦¬ë¡œ ë‹¨ìˆœí™”)
- âœ… API í˜¸ì¶œ 50% ê°ì†Œ
- âœ… ì¬ì‹œë„ ë¡œì§ ë¶ˆí•„ìš”
- âœ… JSON íŒŒì‹± ì˜¤ë¥˜ ì—†ìŒ

## ğŸ“ ì°¸ê³  ìë£Œ

- **Gemini API ë¬¸ì„œ**: https://ai.google.dev/gemini-api/docs
- **ì •ê·œí‘œí˜„ì‹ í…ŒìŠ¤íŠ¸**: https://regex101.com/
- **í”„ë¡œì íŠ¸ êµ¬ì¡°**: `HANDOVER.md` ì°¸ì¡°

## ğŸ“ ë¬¸ì˜

ë¬¸ì œ ë°œìƒ ì‹œ:
1. `logs/` í´ë”ì˜ ìµœê·¼ ë¡œê·¸ í™•ì¸
2. `test_results/` í´ë”ì˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
3. GitHub Issuesì— ë¡œê·¸ì™€ í•¨ê»˜ ë¬¸ì˜
