# Gemini 2.5 Flash 프롬프트 개선안 (최종)

**작성일**: 2025-11-24
**분석 대상**: 5개 회의록 (gemini-2.5-flash 파싱 결과)
**참고 문서**: GEMINI_FLASH_ISSUE_REPORT_1.md ~ GEMINI_FLASH_ISSUE_REPORT_5.md

---

## 📊 5개 회의록 분석 결과 요약

| 회의록 | 회의 유형 | 의사일정 | Gemini 생성 | 주요 문제 |
|--------|----------|----------|-------------|-----------|
| **#1** 행정자치위원회 제4차 | 위원회 | 3개 안건 | 8-10개 | 안건 과다 분할, "외 2건" 추가 |
| **#2** 기획경제위원회 제5차 | 위원회 | 13개 안건 | 13개 + 개의 | line_start 40줄 오차, 개의 안건화 |
| **#3** 본회의 제3차 (시정질문) | 본회의 | 1개 안건 | 수십 개 | 의원별 분할, 의원명 추가 |
| **#4** 도시안전건설위원회 제5차 | 위원회 | 1개 안건 | 4개 | 개의/간부 소개/산회 안건화 |
| **#5** 본회의 개회식 | **의례** | **0개** | **6개** | **전체가 의례인데 안건 생성** |

---

## 🔥 공통 문제점 (모든 회의록)

### 1. 절차/의례를 안건으로 인식 (Critical)
- ❌ 개의, 정회, 속개, 산회
- ❌ 간부 소개
- ❌ 국기에 대한 경례, 애국가 제창, 묵념

### 2. line_start 부정확 (Critical)
- ❌ 메타데이터/제목 (40줄 오차)
- ❌ 의사일정 목록 (6-8줄 오차)
- ❌ 구분선/빈 줄 (2-3줄 오차)

### 3. agenda_title 변경/추가 (Critical)
- ❌ 의원명 추가: "(이영실 의원)", "(이영실 의원 - 2차)"
- ❌ 절차 추가: "외 2건 일괄 상정"
- ❌ 괄호 누락: "(계속)" 삭제

### 4. 안건 과다 분할 (Critical)
- ❌ 하나의 안건 → 여러 개로 분할 (상정/제안설명/질의답변/의결)
- ❌ 하나의 시정질문 → 의원별로 수십 개 분할

### 5. 회의 유형 구분 실패 (Critical)
- ❌ 개회식/폐회식을 일반 회의로 인식
- ❌ 개회식순을 의사일정으로 착각

---

## ✅ 정상 작동 (유지할 강점)
- ✅ download_url 추출 능력 (완벽)
- ✅ 복수 첨부 문서 처리
- ✅ 위원회 대안 안건 통합 인식

---

## 🎯 개선된 프롬프트 (완전 버전)

### Step 1: 회의 유형 판별 (최우선)

```
**STEP 1: 회의 유형 판별**

회의록 제목을 확인하여 회의 유형을 먼저 판별하시오:

1. **개회식/폐회식** (제목에 "개회식" 또는 "폐회식" 포함)
   - 이것은 안건을 심의하는 회의가 아닌 순수 의례 행사
   - "개회식순" 또는 "폐회식순"은 의례 절차이지 의사일정이 아님
   - **agenda_mapping = []** (빈 배열)
   - 이후 단계는 모두 건너뛰고 chunks만 생성

2. **일반 회의** (위원회 회의, 본회의 등)
   - "의사일정" 섹션이 존재
   - 이후 단계 진행
```

---

### Step 2: 안건 정의 (가장 중요)

```
**STEP 2: 안건이란 무엇인가?**

agenda_mapping에는 **"의사일정"에 명시된 안건만** 포함하시오.

**✅ 안건 예시** (의사일정에 나열):
- "1. 2025년도 제2회 행정국 소관 추가경정예산안"
- "2. 서울특별시 감정노동 종사자의 권리보호 등에 관한 조례 일부개정조례안"
- "1. 서울시정 및 교육행정에 관한 질문"

**❌ 안건이 아닌 것** (의사일정에 없음):
- 개의 (회의 시작 절차)
- 정회 (회의 일시 중단)
- 속개 (회의 재개)
- 산회 (회의 종료)
- 간부 소개 (출석자 소개)
- 5분자유발언 (의사일정에 명시된 경우는 안건)

**중요**: 위 절차들은 회의 진행 과정일 뿐, 심의 대상이 아니므로 **절대 agenda_mapping에 포함하지 말 것**
```

---

### Step 3: agenda_title 정확성

```
**STEP 3: agenda_title 작성 규칙**

의사일정에 명시된 안건 제목을 **한 글자도 변경하지 말고** 정확히 그대로 사용하시오.

**✅ 올바른 예시**:
- 의사일정: "1. 서울시정 및 교육행정에 관한 질문"
- agenda_title: "서울시정 및 교육행정에 관한 질문" (정확히 동일)

**❌ 추가하지 말 것**:
- 의원명: "(이영실 의원)", "(김형재 의원)"
- 순서: "- 2차", "- 3차"
- 절차: "일괄 상정", "외 N건"
- 단계: "제안설명", "질의답변", "의결"

**✅ 누락하지 말 것** (괄호 안 내용 포함):
- "(계속)" - 이전 회의에서 보류된 안건
- "(서울특별시장 제출)" - 제출 주체
- "(의안번호 XXXX)" - 의안 번호

**예시**:
```
❌ 잘못된 예: "2025년도 제2회 행정국 소관 추가경정예산안 외 2건 일괄 상정"
✅ 올바른 예: "2025년도 제2회 행정국 소관 추가경정예산안"

❌ 잘못된 예: "서울시정 및 교육행정에 관한 질문 (이영실 의원)"
✅ 올바른 예: "서울시정 및 교육행정에 관한 질문"

❌ 잘못된 예: "서울특별시 재난관리기금 조성 지방채 발행동의안"
✅ 올바른 예: "서울특별시 재난관리기금 조성 지방채 발행동의안(계속)"
```
```

---

### Step 4: 안건 분할 금지

```
**STEP 4: 하나의 안건은 하나로 유지**

의사일정의 1개 안건은 agenda_mapping에서도 **1개 항목**으로 생성하시오.

**❌ 분할하지 말 것**:

1. **안건 처리 단계별 분할 금지**:
   ```
   의사일정: "1. 2025년도 제2회 행정국 소관 추가경정예산안"

   ❌ 잘못된 분할:
   - "2025년도 제2회 행정국 소관 추가경정예산안 일괄 상정"
   - "2025년도 제2회 행정국 소관 추가경정예산안 제안설명"
   - "2025년도 제2회 행정국 소관 추가경정예산안 질의답변"
   - "2025년도 제2회 행정국 소관 추가경정예산안 의결"

   ✅ 올바른 처리: 1개 안건으로 유지
   ```

2. **발언자별 분할 금지** (시정질문 회의):
   ```
   의사일정: "1. 서울시정 및 교육행정에 관한 질문"

   ❌ 잘못된 분할:
   - "서울시정 및 교육행정에 관한 질문 (이영실 의원)"
   - "서울시정 및 교육행정에 관한 질문 (김형재 의원)"
   - "서울시정 및 교육행정에 관한 질문 (윤영희 의원)"

   ✅ 올바른 처리: 1개 안건으로 유지 (여러 의원의 질문 통합)
   ```

3. **답변자별 분할 금지**:
   ```
   ❌ 잘못된 분할:
   - "서울시정 및 교육행정에 관한 질문 (이영실 의원 - 시장 답변)"
   - "서울시정 및 교육행정에 관한 질문 (이영실 의원 - 교육감 답변)"

   ✅ 올바른 처리: 1개 안건으로 유지
   ```

**원칙**: 의사일정 1개 = agenda_mapping 1개
```

---

### Step 5: line_start/line_end 정확성

```
**STEP 5: line_start와 line_end 정의**

**line_start**: 해당 안건의 **첫 번째 발언(○발언자)이 시작되는 줄**

**절대 포함하지 말 것**:
1. 회의록 메타데이터:
   - Line 1-3: 제목, URL, 구분선
2. 회의록 목차:
   - 의사일정 목록
   - 심사된안건 목록
   - 개회식순 목록
3. 구분선 및 장식:
   - `---` (구분선)
   - `(빈 줄)`
4. 시각 표시:
   - `(09시 36분)`
   - `(10시 02분 개의)`
5. 참고 섹션:
   - `(참고)`
   - `[첨부 문서 제목](URL)`

**정확한 line_start**:
```
Line 40: ---
Line 41: (09시 36분)
Line 42: (빈 줄)
Line 43: ○위원장 [강동길]  그러면 의사일정 제1항... ← line_start는 여기 (43)

❌ line_start: 40 (구분선)
❌ line_start: 41 (시각 표시)
❌ line_start: 42 (빈 줄)
✅ line_start: 43 (첫 발언)
```

**line_end**: 해당 안건의 **마지막 발언이 끝나는 줄** (다음 안건 시작 직전)
```

---

### Step 6: 특수 회의 유형 처리

```
**STEP 6: 특수 회의 유형별 처리**

### 1. 시정질문 회의
**특징**:
- 의사일정: "1. 서울시정 및 교육행정에 관한 질문" (단 1개)
- 실제 내용: 여러 의원이 순차적으로 질문

**처리 방법**:
- agenda_mapping: **1개 항목만 생성**
- 여러 의원의 질문을 하나의 안건으로 통합
- speakers: 모든 질문 의원과 답변자를 배열에 포함

### 2. 위원회 대안 가결
**특징**:
- 의사일정에 2개 이상의 유사 안건
- 위원회에서 대안으로 통합하여 가결

**처리 방법**:
- agenda_mapping: **1개 항목**으로 통합
- agenda_title: 두 안건 제목을 모두 포함
- status: "대안 가결"
- 예시:
  ```json
  {
    "agenda_title": "서울특별시 전통시장 및 상점가 육성에 관한 조례 일부개정조례안 (의안번호 2936), 서울특별시 전통시장 및 상점가 육성에 관한 조례 일부개정조례안 (의안번호 2978) 위원회 대안",
    "status": "대안 가결"
  }
  ```

### 3. 보류 안건 재처리
**특징**:
- 의사일정: "1. ○○○안(계속)"
- 이전 회의에서 보류된 안건

**처리 방법**:
- agenda_title: "(계속)" 포함하여 정확히 기재
- 제안설명/검토보고 생략됨 (이미 실시)
```

---

### Step 7: 첨부 문서 처리 (현재 잘 작동 중)

```
**STEP 7: 첨부 문서 URL 추출** (현재 방식 유지)

**현재 방식**: ✅ 완벽하게 작동 중

**확인 사항**:
1. `(참고)` 섹션의 모든 첨부 문서 추출
2. 마크다운 링크 형식: `[제목](URL)`
3. 복수 첨부 문서 모두 배열에 포함
4. 각 안건에 맞는 첨부 문서 매핑

**예시**:
```json
"attachments": [
  {
    "title": "2025년도 제2회 민생노동국 추가경정예산안 검토보고서",
    "download_url": "https://ms.smc.seoul.kr/record/appendixDownload.do?key=..."
  }
]
```

**계속 잘 작동하고 있으므로 현재 방식 유지**
```

---

## 📝 프롬프트 적용 순서 (체크리스트)

```
□ STEP 1: 회의록 제목 확인 → 개회식/폐회식인가?
  └─ Yes → agenda_mapping = [], chunks만 생성, 종료
  └─ No → 다음 단계

□ STEP 2: "의사일정" 섹션 찾기
  └─ 의사일정에 명시된 안건만 추출

□ STEP 3: 각 안건마다:
  □ agenda_title: 의사일정 제목 그대로 (한 글자도 변경 없이)
  □ 괄호 안 내용 포함: "(계속)", "(의안번호 XXXX)" 등
  □ 추가 금지: 의원명, 순서, 절차 문구

□ STEP 4: 안건 분할 확인
  □ 의사일정 1개 = agenda_mapping 1개
  □ 처리 단계별 분할 없음 (상정/제안설명/의결 통합)
  □ 발언자별 분할 없음 (시정질문의 경우)

□ STEP 5: line_start/line_end 설정
  □ line_start: 첫 번째 "○발언자" 줄
  □ 메타데이터/목차/구분선/빈 줄 제외
  □ line_end: 마지막 발언 줄

□ STEP 6: 절차 제외 확인
  □ 개의, 정회, 속개, 산회 제외
  □ 간부 소개 제외
  □ 국기 경례, 애국가 제창, 묵념 제외

□ STEP 7: 첨부 문서 추출
  □ (참고) 섹션의 모든 첨부 문서
  □ download_url 정확히 추출
```

---

## 🧪 테스트 케이스

### 테스트 1: 일반 위원회 회의
**입력**:
```
의사일정:
1. 2025년도 제2회 행정국 소관 추가경정예산안
2. 서울특별시 감정노동 종사자의 권리보호 등에 관한 조례 일부개정조례안
```

**기대 결과**:
```json
{
  "agenda_mapping": [
    {
      "agenda_title": "2025년도 제2회 행정국 소관 추가경정예산안",
      ...
    },
    {
      "agenda_title": "서울특별시 감정노동 종사자의 권리보호 등에 관한 조례 일부개정조례안",
      ...
    }
  ]
}
```
**NOT**:
- ❌ "2025년도 제2회 행정국 소관 추가경정예산안 외 1건"
- ❌ "개의" 안건
- ❌ "정회" 안건

---

### 테스트 2: 시정질문 회의
**입력**:
```
의사일정:
1. 서울시정 및 교육행정에 관한 질문
```

**기대 결과**:
```json
{
  "agenda_mapping": [
    {
      "agenda_title": "서울시정 및 교육행정에 관한 질문",
      "speakers": ["이영실 의원", "김형재 의원", "윤영희 의원", "시장", "교육감", ...],
      ...
    }
  ]
}
```
**NOT**:
- ❌ "서울시정 및 교육행정에 관한 질문 (이영실 의원)"
- ❌ "서울시정 및 교육행정에 관한 질문 (김형재 의원)"

---

### 테스트 3: 개회식
**입력**:
```
제목: 제332회 본회의 개회식(2025.08.27)

개회식순:
1. 개식
1. 국기에 대한 경례
1. 애국가 제창
1. 순국선열 및 호국영령에 대한 묵념
1. 개회사
1. 폐식
```

**기대 결과**:
```json
{
  "meeting_info": {
    "title": "제332회 본회의 개회식(2025.08.27)",
    ...
  },
  "agenda_mapping": [],
  "chunks": [...]
}
```
**NOT**:
- ❌ "개식" 안건
- ❌ "국기에 대한 경례" 안건
- ❌ "애국가 제창" 안건

---

## 🎓 최종 요약

### 핵심 원칙 (3가지)
1. **의사일정에 명시된 안건만** agenda_mapping에 포함
2. **안건 제목은 한 글자도 변경하지 말고** 그대로 사용
3. **의사일정 1개 = agenda_mapping 1개** (분할 금지)

### 특수 케이스
- **개회식/폐회식**: agenda_mapping = []
- **시정질문**: 여러 의원의 질문을 1개 안건으로 통합
- **절차(개의, 정회, 속개, 산회)**: 절대 안건 아님

### 정확성 체크
- **line_start**: 첫 번째 "○발언자" 줄 (메타데이터/목차/구분선 제외)
- **download_url**: 현재 방식 유지 (완벽하게 작동 중)

---

## 📌 프롬프트 통합본 (복사용)

아래는 실제 프롬프트에 추가할 완전한 지침입니다:

```
=== 회의록 파싱 규칙 (Gemini 2.5 Flash 강화 버전) ===

### STEP 1: 회의 유형 판별 (최우선)
회의록 제목에 "개회식" 또는 "폐회식"이 포함되어 있는가?
- YES → 이것은 의례 행사이므로 agenda_mapping = [] (빈 배열), chunks만 생성 후 종료
- NO → 일반 회의이므로 다음 단계 진행

### STEP 2: 안건 정의 (가장 중요)
agenda_mapping에는 **"의사일정"에 명시된 안건만** 포함할 것.

✅ 안건 예시 (의사일정에 나열):
- "1. 2025년도 제2회 행정국 소관 추가경정예산안"
- "2. 서울특별시 감정노동 종사자의 권리보호 등에 관한 조례 일부개정조례안"

❌ 안건이 아닌 것 (의사일정에 없음):
- 개의, 정회, 속개, 산회 (회의 진행 절차)
- 간부 소개 (출석자 소개)
- 개식, 국기에 대한 경례, 애국가 제창, 묵념, 폐식 (의례)

**중요**: 위 절차들은 절대 agenda_mapping에 포함하지 말 것.

### STEP 3: agenda_title 작성 규칙
의사일정에 명시된 안건 제목을 **한 글자도 변경하지 말고** 정확히 그대로 사용.

❌ 추가하지 말 것:
- 의원명: "(이영실 의원)"
- 순서: "- 2차", "- 3차"
- 절차: "일괄 상정", "외 N건"

✅ 누락하지 말 것:
- "(계속)", "(서울특별시장 제출)", "(의안번호 XXXX)" 등 괄호 안 내용

### STEP 4: 안건 분할 금지
의사일정 1개 = agenda_mapping 1개

❌ 분할하지 말 것:
- 안건 처리 단계별 (상정/제안설명/질의답변/의결)
- 발언자별 (시정질문에서 의원별)
- 답변자별 (시장/교육감/국장)

### STEP 5: line_start/line_end 정확성
line_start: 해당 안건의 **첫 번째 발언(○발언자)이 시작되는 줄**

절대 포함하지 말 것:
- 메타데이터 (제목, URL, 구분선)
- 목차 (의사일정 목록, 심사된안건 목록, 개회식순)
- 구분선 (---), 빈 줄
- 시각 표시 ((09시 36분))
- 참고 섹션 ((참고), 첨부 문서 링크)

### STEP 6: 특수 회의 유형
**시정질문 회의**:
- 의사일정 1개 → agenda_mapping 1개 (여러 의원의 질문 통합)

**위원회 대안**:
- 유사 안건 2개 이상 → agenda_mapping 1개 (대안으로 통합)

**보류 안건 재처리**:
- agenda_title에 "(계속)" 포함

### STEP 7: 첨부 문서 (현재 방식 유지)
- (참고) 섹션의 모든 첨부 문서 추출
- download_url 정확히 추출 (현재 완벽하게 작동 중)

=== 규칙 종료 ===
```

---

**문서 작성 완료**
이 개선안을 프롬프트에 적용하면 gemini-2.5-flash의 파싱 정확도가 크게 향상될 것으로 예상됩니다.
